<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Card de Metadados</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            padding: 40px;
        }
        .test-container {
            max-width: 900px;
            margin: 0 auto;
        }
        .test-buttons {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste do Card de Metadados</h1>

        <div class="test-buttons">
            <button onclick="testInception()" class="btn-primary">Testar Inception</button>
            <button onclick="testZootopia()" class="btn-primary">Testar Zootopia</button>
            <button onclick="testOrwell()" class="btn-primary">Testar Orwell</button>
        </div>

        <!-- Movie Metadata Card (copiado do index.html) -->
        <div id="movieMetadataCard" class="movie-metadata-card">
            <div class="metadata-header">
                <h3>üìΩÔ∏è Informa√ß√µes do Filme</h3>
                <button id="refreshMetadataBtn" class="btn-icon-small" title="Recarregar metadados">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M13.65 2.35A7.95 7.95 0 008 0C3.58 0 0 3.58 0 8s3.58 8 8 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L9 7h7V0l-2.35 2.35z" fill="currentColor"/>
                    </svg>
                </button>
            </div>

            <div class="metadata-content">
                <div class="metadata-poster">
                    <img id="moviePoster" src="" alt="Poster" />
                    <div class="poster-placeholder">üé¨</div>
                </div>

                <div class="metadata-info">
                    <h4 id="movieTitle">Carregando...</h4>
                    <div class="movie-details">
                        <span id="movieRating" class="detail-item">‚≠ê -</span>
                        <span id="movieYear" class="detail-item">üìÖ -</span>
                        <span id="movieRuntime" class="detail-item">‚è±Ô∏è -</span>
                    </div>
                    <div id="movieGenres" class="movie-genres"></div>
                    <p id="movieOverview" class="movie-overview"></p>
                </div>
            </div>

            <div id="movieCastSection" class="cast-section hidden">
                <h4>üë• Personagens Principais</h4>
                <div id="movieCast" class="cast-list"></div>
            </div>

            <div class="metadata-options">
                <label class="option-label">
                    <input type="checkbox" id="preserveCharacterNames" checked>
                    <span>Preservar nomes de personagens na tradu√ß√£o</span>
                </label>
                <label class="option-label">
                    <input type="checkbox" id="useMovieContext" checked>
                    <span>Aplicar contexto do filme √† tradu√ß√£o</span>
                </label>
            </div>

            <div id="glossaryPreview" class="glossary-preview hidden">
                <div class="glossary-header">
                    <span>üìù Gloss√°rio: <strong id="glossaryCount">0</strong> termos</span>
                    <button id="viewGlossaryBtn" class="btn-link-small">Ver detalhes</button>
                </div>
                <div id="glossaryTerms" class="glossary-terms hidden"></div>
            </div>
        </div>

        <div id="output" style="margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 12px;">
            <h3>üìä Output (Console)</h3>
            <pre id="consoleOutput" style="white-space: pre-wrap; font-family: monospace; font-size: 0.9em;"></pre>
        </div>
    </div>

    <script src="movie-metadata.js"></script>
    <script>
        // Redirecionar console.log e console.error para output vis√≠vel
        const output = document.getElementById('consoleOutput');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            originalLog.apply(console, args);
            output.textContent += 'üìù ' + args.join(' ') + '\n';
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            output.textContent += '‚ùå ERROR: ' + args.join(' ') + '\n';
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            output.textContent += '‚ö†Ô∏è WARNING: ' + args.join(' ') + '\n';
        };

        // Capturar erros globais
        window.addEventListener('error', function(e) {
            output.textContent += 'üö® ERRO GLOBAL: ' + e.message + ' em ' + e.filename + ':' + e.lineno + '\n';
        });

        // Inicializar manager DEPOIS do redirect do console
        let manager = null;

        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM carregado, inicializando manager...');
            manager = initMovieMetadata();
            console.log('‚úÖ Manager inicializado:', manager);
        });

        async function testInception() {
            if (!manager) {
                console.error('‚ùå Manager ainda n√£o foi inicializado! Aguarde o carregamento da p√°gina.');
                return;
            }
            console.log('\nüé¨ === TESTANDO INCEPTION ===\n');
            output.textContent = 'üé¨ === TESTANDO INCEPTION ===\n\n';
            try {
                const result = await manager.loadMetadata('Inception.2010.1080p.en.srt');
                console.log('Resultado:', result);
            } catch (error) {
                console.error('Erro:', error);
            }
        }

        async function testZootopia() {
            if (!manager) {
                console.error('‚ùå Manager ainda n√£o foi inicializado! Aguarde o carregamento da p√°gina.');
                return;
            }
            console.log('\nüé¨ === TESTANDO ZOOTOPIA ===\n');
            output.textContent = 'üé¨ === TESTANDO ZOOTOPIA ===\n\n';
            try {
                const result = await manager.loadMetadata('Zootopia.2016.BluRay.pt-pt.srt');
                console.log('Resultado:', result);
            } catch (error) {
                console.error('Erro:', error);
            }
        }

        async function testOrwell() {
            if (!manager) {
                console.error('‚ùå Manager ainda n√£o foi inicializado! Aguarde o carregamento da p√°gina.');
                return;
            }
            console.log('\nüé¨ === TESTANDO ORWELL ===\n');
            output.textContent = 'üé¨ === TESTANDO ORWELL ===\n\n';
            try {
                const result = await manager.loadMetadata('Orwell_en.srt');
                console.log('Resultado:', result);
            } catch (error) {
                console.error('Erro:', error);
            }
        }

        // Testar automaticamente Inception ao carregar
        console.log('üöÄ P√°gina carregada - Clique em um dos bot√µes para testar');
    </script>
</body>
</html>
